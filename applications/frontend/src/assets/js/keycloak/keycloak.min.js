(function(a,c){var b=function(A){if(!(this instanceof b)){return new b(A)}var h=this;var q;var v=[];var f;var w={enable:true,callbackList:[],interval:5};h.init=function(F){h.authenticated=false;f=r();if(F&&F.adapter==="cordova"){q=y("cordova")}else{if(F&&F.adapter==="default"){q=y()}else{if(a.Cordova){q=y("cordova")}else{q=y()}}}if(F){if(typeof F.checkLoginIframe!=="undefined"){w.enable=F.checkLoginIframe}if(F.checkLoginIframeInterval){w.interval=F.checkLoginIframeInterval}if(F.onLoad==="login-required"){h.loginRequired=true}if(F.responseMode){if(F.responseMode==="query"||F.responseMode==="fragment"){h.responseMode=F.responseMode}else{throw"Invalid value for responseMode"}}if(F.flow){switch(F.flow){case"standard":h.responseType="code";break;case"implicit":h.responseType="id_token token";break;case"hybrid":h.responseType="code id_token token";break;default:throw"Invalid value for flow"}h.flow=F.flow}if(F.timeSkew!=null){h.timeSkew=F.timeSkew}}if(!h.responseMode){h.responseMode="fragment"}if(!h.responseType){h.responseType="code";h.flow="standard"}var G=d();var C=d();C.promise.success(function(){h.onReady&&h.onReady(h.authenticated);G.setSuccess(h.authenticated)}).error(function(H){G.setError(H)});var E=k(A);function D(){var I=function(J){if(!J){H.prompt="none"}h.login(H).success(function(){C.setSuccess()}).error(function(){C.setError()})};var H={};switch(F.onLoad){case"check-sso":if(w.enable){z().success(function(){m().success(function(){I(false)}).error(function(){C.setSuccess()})})}else{I(false)}break;case"login-required":I(true);break;default:throw"Invalid value for onLoad"}}function B(){var H=g(a.location.href);if(H){z();a.history.replaceState({},null,H.newUrl);o(H,C);return}else{if(F){if(F.token&&F.refreshToken){u(F.token,F.refreshToken,F.idToken);if(w.enable){z().success(function(){m().success(function(){h.onAuthSuccess&&h.onAuthSuccess();C.setSuccess()}).error(function(){u(null,null,null);C.setSuccess()})})}else{h.updateToken(-1).success(function(){h.onAuthSuccess&&h.onAuthSuccess();C.setSuccess()}).error(function(){h.onAuthError&&h.onAuthError();if(F.onLoad){D()}else{C.setError()}})}}else{if(F.onLoad){D()}else{C.setSuccess()}}}else{C.setSuccess()}}}E.success(B);E.error(function(){G.setError()});return G.promise};h.login=function(B){return q.login(B)};h.createLoginUrl=function(D){var H=e();var F=e();var I=q.redirectUri(D);var B={state:H,nonce:F,redirectUri:encodeURIComponent(I),};if(D&&D.prompt){B.prompt=D.prompt}f.add(B);var G="auth";if(D&&D.action=="register"){G="registrations"}var E=(D&&D.scope)?"openid "+D.scope:"openid";var C=p()+"/protocol/openid-connect/"+G+"?client_id="+encodeURIComponent(h.clientId)+"&redirect_uri="+encodeURIComponent(I)+"&state="+encodeURIComponent(H)+"&nonce="+encodeURIComponent(F)+"&response_mode="+encodeURIComponent(h.responseMode)+"&response_type="+encodeURIComponent(h.responseType)+"&scope="+encodeURIComponent(E);if(D&&D.prompt){C+="&prompt="+encodeURIComponent(D.prompt)}if(D&&D.maxAge){C+="&max_age="+encodeURIComponent(D.maxAge)}if(D&&D.loginHint){C+="&login_hint="+encodeURIComponent(D.loginHint)}if(D&&D.idpHint){C+="&kc_idp_hint="+encodeURIComponent(D.idpHint)}if(D&&D.locale){C+="&ui_locales="+encodeURIComponent(D.locale)}return C};h.logout=function(B){return q.logout(B)};h.createLogoutUrl=function(C){var B=p()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(q.redirectUri(C,false));return B};h.register=function(B){return q.register(B)};h.createRegisterUrl=function(B){if(!B){B={}}B.action="register";return h.createLoginUrl(B)};h.createAccountUrl=function(C){var B=p()+"/account?referrer="+encodeURIComponent(h.clientId)+"&referrer_uri="+encodeURIComponent(q.redirectUri(C));return B};h.accountManagement=function(){return q.accountManagement()};h.hasRealmRole=function(C){var B=h.realmAccess;return !!B&&B.roles.indexOf(C)>=0};h.hasResourceRole=function(D,C){if(!h.resourceAccess){return false}var B=h.resourceAccess[C||h.clientId];return !!B&&B.roles.indexOf(D)>=0};h.loadUserProfile=function(){var B=p()+"/account";var C=new XMLHttpRequest();C.open("GET",B,true);C.setRequestHeader("Accept","application/json");C.setRequestHeader("Authorization","bearer "+h.token);var D=d();C.onreadystatechange=function(){if(C.readyState==4){if(C.status==200){h.profile=JSON.parse(C.responseText);D.setSuccess(h.profile)}else{D.setError()}}};C.send();return D.promise};h.loadUserInfo=function(){var B=p()+"/protocol/openid-connect/userinfo";var C=new XMLHttpRequest();C.open("GET",B,true);C.setRequestHeader("Accept","application/json");C.setRequestHeader("Authorization","bearer "+h.token);var D=d();C.onreadystatechange=function(){if(C.readyState==4){if(C.status==200){h.userInfo=JSON.parse(C.responseText);D.setSuccess(h.userInfo)}else{D.setError()}}};C.send();return D.promise};h.isTokenExpired=function(B){if(!h.tokenParsed||(!h.refreshToken&&h.flow!="implicit")){throw"Not authenticated"}if(h.timeSkew==null){console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set");return true}var C=h.tokenParsed.exp-Math.ceil(new Date().getTime()/1000)+h.timeSkew;if(B){C-=B}return C<0};h.updateToken=function(B){var E=d();if(!h.refreshToken){E.setError();return E.promise}B=B||5;var C=function(){var H=false;if(B==-1){H=true;console.info("[KEYCLOAK] Refreshing token: forced refresh")}else{if(!h.tokenParsed||h.isTokenExpired(B)){H=true;console.info("[KEYCLOAK] Refreshing token: token expired")}}if(!H){E.setSuccess(false)}else{var J="grant_type=refresh_token&refresh_token="+h.refreshToken;var G=p()+"/protocol/openid-connect/token";v.push(E);if(v.length==1){var I=new XMLHttpRequest();I.open("POST",G,true);I.setRequestHeader("Content-type","application/x-www-form-urlencoded");I.withCredentials=true;if(h.clientId&&h.clientSecret){I.setRequestHeader("Authorization","Basic "+btoa(h.clientId+":"+h.clientSecret))}else{J+="&client_id="+encodeURIComponent(h.clientId)}var F=new Date().getTime();I.onreadystatechange=function(){if(I.readyState==4){if(I.status==200){console.info("[KEYCLOAK] Token refreshed");F=(F+new Date().getTime())/2;var L=JSON.parse(I.responseText);u(L.access_token,L.refresh_token,L.id_token,F);h.onAuthRefreshSuccess&&h.onAuthRefreshSuccess();for(var K=v.pop();K!=null;K=v.pop()){K.setSuccess(true)}}else{console.warn("[KEYCLOAK] Failed to refresh token");h.onAuthRefreshError&&h.onAuthRefreshError();for(var K=v.pop();K!=null;K=v.pop()){K.setError(true)}}}};I.send(J)}}};if(w.enable){var D=m();D.success(function(){C()}).error(function(){E.setError()})}else{C()}return E.promise};h.clearToken=function(){if(h.token){u(null,null,null);h.onAuthLogout&&h.onAuthLogout();if(h.loginRequired){h.login()}}};function p(){if(h.authServerUrl.charAt(h.authServerUrl.length-1)=="/"){return h.authServerUrl+"realms/"+encodeURIComponent(h.realm)}else{return h.authServerUrl+"/realms/"+encodeURIComponent(h.realm)}}function x(){if(!a.location.origin){return a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")}else{return a.location.origin}}function o(I,L){var E=I.code;var J=I.error;var F=I.prompt;var D=new Date().getTime();if(J){if(F!="none"){var C={error:J,error_description:I.error_description};h.onAuthError&&h.onAuthError(C);L&&L.setError(C)}else{L&&L.setSuccess()}return}else{if((h.flow!="standard")&&(I.access_token||I.id_token)){H(I.access_token,null,I.id_token,true)}}if((h.flow!="implicit")&&E){var G="code="+E+"&grant_type=authorization_code";var B=p()+"/protocol/openid-connect/token";var K=new XMLHttpRequest();K.open("POST",B,true);K.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(h.clientId&&h.clientSecret){K.setRequestHeader("Authorization","Basic "+btoa(h.clientId+":"+h.clientSecret))}else{G+="&client_id="+encodeURIComponent(h.clientId)}G+="&redirect_uri="+I.redirectUri;K.withCredentials=true;K.onreadystatechange=function(){if(K.readyState==4){if(K.status==200){var M=JSON.parse(K.responseText);H(M.access_token,M.refresh_token,M.id_token,h.flow==="standard")}else{h.onAuthError&&h.onAuthError();L&&L.setError()}}};K.send(G)}function H(M,N,P,O){D=(D+new Date().getTime())/2;u(M,N,P,D);if((h.tokenParsed&&h.tokenParsed.nonce!=I.storedNonce)||(h.refreshTokenParsed&&h.refreshTokenParsed.nonce!=I.storedNonce)||(h.idTokenParsed&&h.idTokenParsed.nonce!=I.storedNonce)){console.info("[KEYCLOAK] Invalid nonce, clearing token");h.clearToken();L&&L.setError()}else{if(O){h.onAuthSuccess&&h.onAuthSuccess();L&&L.setSuccess()}}}}function k(D){var G=d();var C;if(!A){C="keycloak.json"}else{if(typeof A==="string"){C=A}}if(C){var F=new XMLHttpRequest();F.open("GET",C,true);F.setRequestHeader("Accept","application/json");F.onreadystatechange=function(){if(F.readyState==4){if(F.status==200||i(F)){var H=JSON.parse(F.responseText);h.authServerUrl=H["auth-server-url"];h.realm=H.realm;h.clientId=H.resource;h.clientSecret=(H.credentials||{})["secret"];G.setSuccess()}else{G.setError()}}};F.send()}else{if(!A.url){var B=document.getElementsByTagName("script");for(var E=0;E<B.length;E++){if(B[E].src.match(/.*keycloak\.js/)){A.url=B[E].src.substr(0,B[E].src.indexOf("/js/keycloak.js"));break}}}if(!A.realm){throw"realm missing"}if(!A.clientId){throw"clientId missing"}h.authServerUrl=A.url;h.realm=A.realm;h.clientId=A.clientId;h.clientSecret=(A.credentials||{}).secret;G.setSuccess()}return G.promise}function i(B){return B.status==0&&B.responseText&&B.responseURL.startsWith("file:")}function u(E,D,F,C){if(h.tokenTimeoutHandle){clearTimeout(h.tokenTimeoutHandle);h.tokenTimeoutHandle=null}if(D){h.refreshToken=D;h.refreshTokenParsed=s(D)}else{delete h.refreshToken;delete h.refreshTokenParsed}if(F){h.idToken=F;h.idTokenParsed=s(F)}else{delete h.idToken;delete h.idTokenParsed}if(E){h.token=E;h.tokenParsed=s(E);h.sessionId=h.tokenParsed.session_state;h.authenticated=true;h.subject=h.tokenParsed.sub;h.realmAccess=h.tokenParsed.realm_access;h.resourceAccess=h.tokenParsed.resource_access;if(C){h.timeSkew=Math.floor(C/1000)-h.tokenParsed.iat}if(h.timeSkew!=null){console.info("[KEYCLOAK] Estimated time difference between browser and server is "+h.timeSkew+" seconds");if(h.onTokenExpired){var B=(h.tokenParsed.exp-(new Date().getTime()/1000)+h.timeSkew)*1000;console.info("[KEYCLOAK] Token expires in "+Math.round(B/1000)+" s");if(B<=0){h.onTokenExpired()}else{h.tokenTimeoutHandle=setTimeout(h.onTokenExpired,B)}}}}else{delete h.token;delete h.tokenParsed;delete h.subject;delete h.realmAccess;delete h.resourceAccess;h.authenticated=false}}function s(B){B=B.split(".")[1];B=B.replace("/-/g","+");B=B.replace("/_/g","/");switch(B.length%4){case 0:break;case 2:B+="==";break;case 3:B+="=";break;default:throw"Invalid token"}B=(B+"===").slice(0,B.length+(B.length%4));B=B.replace(/-/g,"+").replace(/_/g,"/");B=decodeURIComponent(escape(atob(B)));B=JSON.parse(B);return B}function e(){var E=[];var B="0123456789abcdef";for(var C=0;C<36;C++){E[C]=B.substr(Math.floor(Math.random()*16),1)}E[14]="4";E[19]=B.substr((E[19]&3)|8,1);E[8]=E[13]=E[18]=E[23]="-";var D=E.join("");return D}h.callback_id=0;function t(){var B="<id: "+(h.callback_id++)+(Math.random())+">";return B}function g(C){var B=new l(C,h.responseMode).parseUri();var D=f.get(B.state);if(D&&(B.code||B.error||B.access_token||B.id_token)){B.redirectUri=D.redirectUri;B.storedNonce=D.nonce;B.prompt=D.prompt;if(B.fragment){B.newUrl+="#"+B.fragment}return B}}function d(){var B={setSuccess:function(C){B.success=true;B.result=C;if(B.successCallback){B.successCallback(C)}},setError:function(C){B.error=true;B.result=C;if(B.errorCallback){B.errorCallback(C)}},promise:{success:function(C){if(B.success){C(B.result)}else{if(!B.error){B.successCallback=C}}return B.promise},error:function(C){if(B.error){C(B.result)}else{if(!B.success){B.errorCallback=C}}return B.promise}}};return B}function z(){var F=d();if(!w.enable){F.setSuccess();return F.promise}if(w.iframe){F.setSuccess();return F.promise}var D=document.createElement("iframe");w.iframe=D;D.onload=function(){var G=p();if(G.charAt(0)==="/"){w.iframeOrigin=x()}else{w.iframeOrigin=G.substring(0,G.indexOf("/",8))}F.setSuccess();setTimeout(B,w.interval*1000)};var E=p()+"/protocol/openid-connect/login-status-iframe.html";D.setAttribute("src",E);D.style.display="none";document.body.appendChild(D);var C=function(I){if((I.origin!==w.iframeOrigin)||(w.iframe.contentWindow!==I.source)){return}if(!(I.data=="unchanged"||I.data=="changed"||I.data=="error")){return}if(I.data!="unchanged"){h.clearToken()}var H=w.callbackList.splice(0,w.callbackList.length);for(var G=H.length-1;G>=0;--G){var J=H[G];if(I.data=="unchanged"){J.setSuccess()}else{J.setError()}}};a.addEventListener("message",C,false);var B=function(){m();if(h.token){setTimeout(B,w.interval*1000)}};return F.promise}function m(){var D=d();if(w.iframe&&w.iframeOrigin){var C=h.clientId+" "+h.sessionId;w.callbackList.push(D);var B=w.iframeOrigin;if(w.callbackList.length==1){w.iframe.contentWindow.postMessage(C,B)}}else{D.setSuccess()}return D.promise}function y(B){if(!B||B=="default"){return{login:function(C){a.location.href=h.createLoginUrl(C);return d().promise},logout:function(C){a.location.href=h.createLogoutUrl(C);return d().promise},register:function(C){a.location.href=h.createRegisterUrl(C);return d().promise},accountManagement:function(){a.location.href=h.createAccountUrl();return d().promise},redirectUri:function(C,D){if(arguments.length==1){D=true}if(C&&C.redirectUri){return C.redirectUri}else{if(h.redirectUri){return h.redirectUri}else{var E=location.href;if(location.hash&&D){E=E.substring(0,location.href.indexOf("#"));E+=(E.indexOf("?")==-1?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))}return E}}}}}if(B=="cordova"){w.enable=false;return{login:function(C){var H=d();var G="location=no";if(C&&C.prompt=="none"){G+=",hidden=yes"}var F=h.createLoginUrl(C);var E=a.open(F,"_blank",G);var D=false;E.addEventListener("loadstart",function(I){if(I.url.indexOf("http://localhost")==0){var J=g(I.url);o(J,H);E.close();D=true}});E.addEventListener("loaderror",function(I){if(!D){if(I.url.indexOf("http://localhost")==0){var J=g(I.url);o(J,H);E.close();D=true}else{H.setError();E.close()}}});return H.promise},logout:function(E){var G=d();var C=h.createLogoutUrl(E);var F=a.open(C,"_blank","location=no,hidden=yes");var D;F.addEventListener("loadstart",function(H){if(H.url.indexOf("http://localhost")==0){F.close()}});F.addEventListener("loaderror",function(H){if(H.url.indexOf("http://localhost")==0){F.close()}else{D=true;F.close()}});F.addEventListener("exit",function(H){if(D){G.setError()}else{h.clearToken();G.setSuccess()}});return G.promise},register:function(){var C=h.createRegisterUrl();var D=a.open(C,"_blank","location=no");D.addEventListener("loadstart",function(E){if(E.url.indexOf("http://localhost")==0){D.close()}})},accountManagement:function(){var C=h.createAccountUrl();var D=a.open(C,"_blank","location=no");D.addEventListener("loadstart",function(E){if(E.url.indexOf("http://localhost")==0){D.close()}})},redirectUri:function(C){return"http://localhost"}}}throw"invalid adapter type: "+B}var n=function(){if(!(this instanceof n)){return new n()}localStorage.setItem("kc-test","test");localStorage.removeItem("kc-test");var B=this;function C(){var I=new Date().getTime();for(var F=0;F<localStorage.length;F++){var E=localStorage.key(F);if(E&&E.indexOf("kc-callback-")==0){var H=localStorage.getItem(E);if(H){try{var D=JSON.parse(H).expires;if(!D||D<I){localStorage.removeItem(E)}}catch(G){localStorage.removeItem(E)}}}}}B.get=function(F){if(!F){return}var D="kc-callback-"+F;var E=localStorage.getItem(D);if(E){localStorage.removeItem(D);E=JSON.parse(E)}C();return E};B.add=function(E){C();var D="kc-callback-"+E.state;E.expires=new Date().getTime()+(60*60*1000);localStorage.setItem(D,JSON.stringify(E))}};var j=function(){if(!(this instanceof j)){return new j()}var D=this;D.get=function(G){if(!G){return}var F=B("kc-callback-"+G);C("kc-callback-"+G,"",E(-100));if(F){return JSON.parse(F)}};D.add=function(F){C("kc-callback-"+F.state,JSON.stringify(F),E(60))};D.removeItem=function(F){C(F,"",E(-100))};var E=function(F){var G=new Date();G.setTime(G.getTime()+(F*60*1000));return G};var B=function(I){var G=I+"=";var F=document.cookie.split(";");for(var H=0;H<F.length;H++){var J=F[H];while(J.charAt(0)==" "){J=J.substring(1)}if(J.indexOf(G)==0){return J.substring(G.length,J.length)}}return""};var C=function(H,I,F){var G=H+"="+I+"; expires="+F.toUTCString()+"; ";document.cookie=G}};function r(){try{return new n()}catch(B){}return new j()}var l=function(B,E){if(!(this instanceof l)){return new l(B,E)}var G=this;var C=function(){var K=null;var L=null;var J=null;var H=B.indexOf("?");var I=B.indexOf("#",H+1);if(H==-1&&I==-1){K=B}else{if(H!=-1){K=B.substring(0,H);L=B.substring(H+1);if(I!=-1){I=L.indexOf("#");J=L.substring(I+1);L=L.substring(0,I)}}else{K=B.substring(0,I);J=B.substring(I+1)}}return{baseUri:K,queryString:L,fragmentString:J}};var D=function(N){var H={};var M=N.split("&");for(var I=0;I<M.length;I++){var K=M[I].split("=");var J=decodeURIComponent(K[0]);var L=decodeURIComponent(K[1]);H[J]=L}return H};var F=function(K,L,H){var J=["code","state","error","error_description"];for(var I=0;I<J.length;I++){if(K===J[I]){H[K]=L;return true}}return false};G.parseUri=function(){var L=C();var J={};if(L.queryString){J=D(L.queryString)}var H={newUrl:L.baseUri};for(var K in J){switch(K){case"redirect_fragment":H.fragment=J[K];break;default:if(E!="query"||!F(K,J[K],H)){H.newUrl+=(H.newUrl.indexOf("?")==-1?"?":"&")+K+"="+encodeURIComponent(J[K])}break}}if(E==="fragment"){var I={};if(L.fragmentString){I=D(L.fragmentString)}for(var K in I){H[K]=I[K]}}return H}}};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=b}else{a.Keycloak=b;if(typeof define==="function"&&define.amd){define("keycloak",[],function(){return b})}}})(window);
